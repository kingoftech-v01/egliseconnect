{% load static %}
{% load i18n %}
<div class="header" data-notifications-enabled>
    <div class="header-content">
        <nav class="navbar navbar-expand">
            <div class="collapse navbar-collapse justify-content-between">
                <div class="header-left">
                    <form action="/search/" method="GET">
                        <div class="input-group search-area">
                            <span class="input-group-text"><button type="submit" class="bg-transparent border-0">
                                <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="8.78605" cy="8.78605" r="8.23951" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14.5168 14.9447L17.7471 18.1667" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button></span>
                            <input type="text" class="form-control" name="q" placeholder="{% trans 'Rechercher...' %}" value="{{ request.GET.q|default:'' }}" autocomplete="off">
                        </div>
                    </form>
                </div>
                <ul class="navbar-nav header-right">
                    {% if request.user.is_authenticated %}
                    <!-- Language Switcher -->
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" title="{% trans 'Langue' %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <form method="POST" action="/settings/set-language/">
                                {% csrf_token %}
                                <input type="hidden" name="next" value="{{ request.path }}">
                                <button type="submit" name="language" value="fr" class="dropdown-item {% if LANGUAGE_CODE == 'fr' or current_language == 'fr' %}active{% endif %}">
                                    Fran&ccedil;ais
                                </button>
                                <button type="submit" name="language" value="en" class="dropdown-item {% if current_language == 'en' %}active{% endif %}">
                                    English
                                </button>
                            </form>
                        </div>
                    </li>
                    {% endif %}

                    {% if request.user.is_authenticated and request.user.member_profile %}
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="/communication/notifications/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                            <span class="badge badge-sm badge-circle badge-danger position-absolute top-0 end-0 notification-badge-count" {% if not unread_notification_count %}style="display:none"{% endif %}>{{ unread_notification_count|default:"0" }}</span>
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item dropdown header-profile">
                        <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                            <div class="header-info2 d-flex align-items-center">
                                <div class="header-media">
                                    {% if request.user.member_profile and request.user.member_profile.photo %}
                                    <img src="{{ request.user.member_profile.photo.url }}" alt="" style="object-fit: cover;">
                                    {% else %}
                                    <img src="{% static 'w3crm/images/tab/1.jpg' %}" alt="">
                                    {% endif %}
                                </div>
                                <div class="header-info">
                                    <h6>{{ request.user.get_full_name|default:request.user.username }}</h6>
                                    <p>{% if request.user.is_superuser %}Admin{% else %}{% trans "Membre" %}{% endif %}</p>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a href="/members/my-profile/" class="dropdown-item ai-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                <span class="ms-2">{% trans "Profil" %}</span>
                            </a>
                            <a href="/accounts/logout/" class="dropdown-item ai-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                <span class="ms-2">{% trans "DÃ©connexion" %}</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</div>
<!-- Search autocomplete & Notifications WebSocket -->
<script src="{% static 'w3crm/js/search-autocomplete.js' %}"></script>
<script src="{% static 'w3crm/js/notifications.js' %}"></script>
