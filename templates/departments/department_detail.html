{% extends 'base.html' %}
{% load static custom_tags %}
{% block title %}{{ department.name }} - Departement{% endblock %}
{% block content %}
<div class="content-body">
    <div class="page-titles">
        <ol class="breadcrumb">
            <li><h5 class="bc-title">{{ department.name }}</h5></li>
            <li class="breadcrumb-item"><a href="/reports/">Accueil</a></li>
            <li class="breadcrumb-item"><a href="/members/departments/">Departements</a></li>
            <li class="breadcrumb-item active"><a href="javascript:void(0)">{{ department.name }}</a></li>
        </ol>
        <div>
            <a href="/members/departments/{{ department.pk }}/edit/" class="btn btn-outline-primary btn-sm me-2">
                <i class="fas fa-edit me-1"></i>Modifier
            </a>
            <a href="/members/departments/{{ department.pk }}/add-member/" class="btn btn-primary btn-sm">
                <i class="fas fa-user-plus me-1"></i>Ajouter un membre
            </a>
        </div>
    </div>
    <div class="container-fluid">
        <!-- Department Info -->
        <div class="row mb-4">
            <div class="col-xl-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="heading mb-0">Informations</h4>
                    </div>
                    <div class="card-body">
                        {% if department.description %}
                        <p>{{ department.description }}</p>
                        {% endif %}
                        <div class="row">
                            <div class="col-md-4">
                                <p class="text-muted mb-1">Leader</p>
                                <strong>{{ department.leader.full_name|default:"-" }}</strong>
                            </div>
                            <div class="col-md-4">
                                <p class="text-muted mb-1">Reunion</p>
                                <strong>{{ department.meeting_day|default:"-" }}
                                {% if department.meeting_time %} a {{ department.meeting_time|time:"H:i" }}{% endif %}</strong>
                            </div>
                            <div class="col-md-4">
                                <p class="text-muted mb-1">Lieu</p>
                                <strong>{{ department.meeting_location|default:"-" }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <h4 class="heading mb-0">Types de taches</h4>
                        <a href="/members/departments/{{ department.pk }}/task-types/" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                    <div class="card-body">
                        {% if task_types %}
                        <ul class="list-group list-group-flush">
                            {% for task in task_types %}
                            <li class="list-group-item d-flex justify-content-between px-0">
                                <span>{{ task.name }}</span>
                                <small class="text-muted">max {{ task.max_assignees }}</small>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-muted mb-0">Aucun type de tache defini.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Members -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <h4 class="heading mb-0">Membres ({{ memberships|length }})</h4>
                    </div>
                    <div class="card-body">
                        {% if memberships %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Membre</th>
                                        <th>Role</th>
                                        <th>Depuis</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ms in memberships %}
                                    <tr>
                                        <td>
                                            <a href="/members/{{ ms.member.pk }}/">{{ ms.member.full_name }}</a>
                                        </td>
                                        <td>
                                            {% if ms.role == 'leader' %}
                                            <span class="badge bg-primary">Leader</span>
                                            {% elif ms.role == 'assistant' %}
                                            <span class="badge bg-info">Assistant</span>
                                            {% else %}
                                            <span class="badge bg-secondary">Membre</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ ms.joined_date|date:"d/m/Y" }}</td>
                                        <td>
                                            <form method="post" action="/members/departments/{{ department.pk }}/remove-member/{{ ms.pk }}/" class="d-inline">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-outline-danger btn-sm" title="Retirer du departement" onclick="return confirm('Retirer {{ ms.member.full_name }} du departement?')">
                                                    <i class="fas fa-user-minus"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">Aucun membre dans ce departement.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
