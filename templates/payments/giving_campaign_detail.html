{% extends 'base.html' %}
{% load i18n static custom_tags %}

{% block content %}
<div class="content-body">
    <div class="page-titles">
        <ol class="breadcrumb">
            <li><h5 class="bc-title">{{ page_title }}</h5></li>
            <li class="breadcrumb-item"><a href="/reports/">{% trans "Accueil" %}</a></li>
            <li class="breadcrumb-item"><a href="/payments/campaigns/">{% trans "Campagnes" %}</a></li>
            <li class="breadcrumb-item active"><a href="javascript:void(0)">{{ page_title }}</a></li>
        </ol>
    </div>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-xl-8 col-lg-10">
                <div class="card">
                    {% if campaign.image %}
                    <img src="{{ campaign.image.url }}" class="card-img-top" alt="{{ campaign.name }}" style="max-height: 300px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h3>{{ campaign.name }}</h3>
                            {% if campaign.is_year_end %}
                            <span class="badge badge-warning">{% trans "Campagne fin d'année" %}</span>
                            {% endif %}
                        </div>

                        {% if campaign.description %}
                        <p class="mb-4">{{ campaign.description }}</p>
                        {% endif %}

                        <!-- Thermometer -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="fw-bold">{{ campaign.current_amount }} CAD</span>
                                <span class="text-muted">{% trans "Objectif:" %} {{ campaign.goal_amount }} CAD</span>
                            </div>
                            {% include 'payments/_campaign_thermometer.html' with campaign=campaign %}
                        </div>

                        <!-- Countdown -->
                        {% if campaign.is_ongoing %}
                        <div class="text-center mb-4" id="countdown-container">
                            <h4 class="text-primary" id="countdown-text">{{ campaign.days_remaining }} {% trans "jours restants" %}</h4>
                            <p class="text-muted">
                                {{ campaign.start_date|date:"d/m/Y" }} - {{ campaign.end_date|date:"d/m/Y" }}
                            </p>
                        </div>
                        {% elif not campaign.is_ongoing and campaign.days_remaining == 0 %}
                        <div class="alert alert-secondary text-center">
                            {% trans "Cette campagne est terminée." %}
                        </div>
                        {% endif %}

                        <div class="text-center">
                            <a href="/payments/donate/?campaign={{ campaign.pk }}" class="btn btn-primary btn-lg">
                                <i class="fa fa-heart me-2"></i>{% trans "Donner maintenant" %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
{% if campaign.is_ongoing %}
<script>
// Countdown timer
(function() {
    var endDate = new Date('{{ campaign.end_date|date:"Y-m-d" }}T23:59:59');
    function updateCountdown() {
        var now = new Date();
        var diff = endDate - now;
        if (diff <= 0) {
            document.getElementById('countdown-text').textContent = 'Campagne terminée';
            return;
        }
        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        document.getElementById('countdown-text').textContent =
            days + ' jours, ' + hours + 'h ' + minutes + 'min restants';
    }
    updateCountdown();
    setInterval(updateCountdown, 60000);
})();
</script>
{% endif %}
{% endblock %}
