{% extends "account/base_auth.html" %}
{% load custom_tags i18n %}

{% block head_title %}{% if token_fail %}Lien invalide{% else %}Nouveau mot de passe{% endif %}{% endblock %}

{% block auth_title %}{% if token_fail %}Lien invalide{% else %}Nouveau mot de passe{% endif %}{% endblock %}
{% block auth_subtitle %}{% if token_fail %}Ce lien a expire ou est invalide{% else %}Choisissez votre nouveau mot de passe{% endif %}{% endblock %}

{% block auth_form %}
{% if token_fail %}
<div class="text-center">
    <div class="mb-4">
        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
    </div>
    <p class="mb-4">
        Ce lien de reinitialisation est invalide ou a deja ete utilise.
        Veuillez <a href="{% url 'account_reset_password' %}">demander un nouveau lien</a>.
    </p>
</div>
{% else %}
<form method="post" action="{{ action_url }}">
    {% csrf_token %}
    {{ redirect_field }}
    {% for field in form %}
    <div class="mb-4">
        <label class="mb-1 text-dark" for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field|add_class:"form-control" }}
        {% if field.help_text %}
        <small class="form-text text-muted">{{ field.help_text }}</small>
        {% endif %}
        {% for error in field.errors %}
        <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
    </div>
    {% endfor %}
    <div class="text-center mb-4">
        <button type="submit" name="action" class="btn btn-primary btn-block">Changer le mot de passe</button>
    </div>
</form>
<form id="logout-from-stage" method="post" action="{% url 'account_logout' %}">
    <input type="hidden" name="next" value="{% url 'account_login' %}">
    {% csrf_token %}
</form>
{% endif %}
{% endblock %}
