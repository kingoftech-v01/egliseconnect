{% extends "account/base_manage_auth.html" %}
{% load static custom_tags i18n %}

{% block head_title %}Adresses e-mail{% endblock %}

{% block page_title %}Adresses e-mail{% endblock %}
{% block breadcrumb_items %}
    <li class="breadcrumb-item"><a href="javascript:void(0)">Compte</a></li>
    <li class="breadcrumb-item active"><a href="javascript:void(0)">Adresses e-mail</a></li>
{% endblock %}

{% block content %}
<h4 class="heading mb-4">Adresses e-mail</h4>

{% if emailaddresses %}
<p class="mb-3">Les adresses e-mail suivantes sont associees a votre compte :</p>
<form method="post" action="{% url 'account_email' %}">
    {% csrf_token %}
    <div class="list-group mb-3">
        {% for radio in emailaddress_radios %}
        {% with emailaddress=radio.emailaddress %}
        <label class="list-group-item d-flex justify-content-between align-items-center" for="{{ radio.id }}">
            <div>
                <input type="radio" name="email" value="{{ emailaddress.email }}" id="{{ radio.id }}" {% if radio.checked %}checked{% endif %} class="form-check-input me-2">
                {{ emailaddress.email }}
                {% if emailaddress.verified %}
                <span class="badge bg-success ms-2">Verifie</span>
                {% else %}
                <span class="badge bg-warning ms-2">Non verifie</span>
                {% endif %}
                {% if emailaddress.primary %}
                <span class="badge bg-primary ms-2">Principal</span>
                {% endif %}
            </div>
        </label>
        {% endwith %}
        {% endfor %}
    </div>
    <div class="d-flex gap-2 mb-4">
        <button type="submit" name="action_primary" class="btn btn-sm btn-primary">Rendre principal</button>
        <button type="submit" name="action_send" class="btn btn-sm btn-secondary">Renvoyer la verification</button>
        <button type="submit" name="action_remove" class="btn btn-sm btn-danger">Supprimer</button>
    </div>
</form>
{% else %}
<div class="alert alert-warning">
    <strong>Attention :</strong> Aucune adresse e-mail n'est associee a votre compte.
</div>
{% endif %}

{% if can_add_email %}
<h5 class="heading mb-3 mt-4">Ajouter une adresse e-mail</h5>
<form method="post" action="{% url 'account_email' %}">
    {% csrf_token %}
    {% for field in form %}
    <div class="mb-3">
        <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field|add_class:"form-control" }}
        {% for error in field.errors %}
        <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
    </div>
    {% endfor %}
    <button type="submit" name="action_add" class="btn btn-primary">Ajouter</button>
</form>
{% endif %}
{% endblock %}

{% block extra_body %}
<script src="{% static 'account/js/account.js' %}"></script>
<script src="{% static 'account/js/onload.js' %}"></script>
<script data-allauth-onload="allauth.account.forms.manageEmailForm" type="application/json">{
    "i18n": {"confirmDelete": "Voulez-vous vraiment supprimer l'adresse e-mail selectionnee ?"}
}
</script>
{% endblock %}
