{% extends "account/base_manage_auth.html" %}
{% load custom_tags i18n %}

{% block head_title %}Activer l'application d'authentification{% endblock %}

{% block page_title %}Activer l'application d'authentification{% endblock %}
{% block breadcrumb_items %}
    <li class="breadcrumb-item"><a href="{% url 'mfa_index' %}">Securite 2FA</a></li>
    <li class="breadcrumb-item active"><a href="javascript:void(0)">Activer</a></li>
{% endblock %}

{% block content %}
<h4 class="heading mb-4">Activer l'application d'authentification</h4>
<p class="mb-4">
    Pour proteger votre compte avec l'authentification a deux facteurs, scannez le code QR
    ci-dessous avec votre application d'authentification. Ensuite, entrez le code de verification
    genere par l'application.
</p>

<div class="text-center mb-4">
    <img src="{{ totp_svg_data_uri }}" alt="Code QR" class="img-fluid" style="max-width: 250px;">
</div>

<form method="post" action="{% url 'mfa_activate_totp' %}">
    {% csrf_token %}
    <div class="mb-3">
        <label class="form-label">Cle secrete</label>
        <input type="text" class="form-control" value="{{ form.secret }}" disabled readonly>
        <small class="form-text text-muted">
            Conservez cette cle pour reinstaller votre application d'authentification ulterieurement.
        </small>
    </div>
    {% for field in form %}
    <div class="mb-3">
        <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field|add_class:"form-control" }}
        {% for error in field.errors %}
        <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
    </div>
    {% endfor %}
    <div class="d-flex justify-content-between align-items-center mt-4">
        <a href="{% url 'mfa_index' %}" class="btn btn-light">Annuler</a>
        <button type="submit" class="btn btn-primary">Activer</button>
    </div>
</form>
{% endblock %}
